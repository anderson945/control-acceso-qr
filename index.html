<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Control de Accesos - Escuela de Padres</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
  body { font-family: Arial, sans-serif; text-align: center; background: #f0f4f8; }
  #reader { margin: 20px auto; width: 320px; }
  .msg { margin-top: 20px; font-size: 18px; font-weight: bold; }
  .ok { color: green; }
  .bloqueado { color: red; }
</style>
</head>
<body>
<h1>Escanear QR - Escuela de Padres</h1>
<div id="reader"></div>
<div id="mensaje" class="msg"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbx92TPknHLScO6XpFMmHbuHQR6CGkBSY2S2SubMD9G4pc_pQhWOgMMkmmiEWrlqyvai/exec";

function procesarQR(qrData) {
  fetch(`${API_URL}?codigo=${qrData}`)
    .then(res => res.json())
    .then(resp => {
      const msgDiv = document.getElementById('mensaje');
      msgDiv.textContent = resp.mensaje;
      msgDiv.className = "msg " + (resp.status === "ok" ? "ok" :
                                   resp.status === "bloqueado" ? "bloqueado" : "");
    })
    .catch(err => {
      document.getElementById('mensaje').textContent = "Error de conexi√≥n con el servidor.";
      console.error(err);
    });
}

function onScanSuccess(qrData) {
  procesarQR(qrData);
}

const scanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 });
scanner.render(onScanSuccess);
</script>
</body>
</html>
